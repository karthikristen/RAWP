<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>💧☢️ RAWP - Radioactive Water Predicter</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background:#0a0a0a; color:#e8f5e9; font-family: 'Bebas Neue', sans-serif; text-align:center; }
    h1 { color:#FFD300; text-shadow:0 0 10px #FFD300; }
    .container { width:80%; margin:auto; }
    input, textarea { padding:8px; margin:6px; width:80%; border-radius:6px; }
    button { padding:10px 20px; margin:10px; background:#FFD300; border:none; border-radius:6px; font-weight:bold; }
    .box { background:#111; padding:15px; border-radius:12px; margin:15px 0; }
    canvas { margin:20px auto; }
  </style>
</head>
<body>
  <h1>💧☢️ RAWP</h1>
  <p>Radioactive Water Predicter Dashboard</p>
  <div class="container">
    <form id="waterForm">
      <input type="number" step="0.1" name="ph" placeholder="pH (0–100 scale)" required><br>
      <input type="number" step="0.1" name="tds" placeholder="TDS (0–100 scale)" required><br>
      <input type="number" step="0.1" name="hardness" placeholder="Hardness (0–100 scale)" required><br>
      <input type="number" step="0.1" name="nitrate" placeholder="Nitrate (0–100 scale)" required><br>
      <input type="text" name="location" placeholder="Location"><br>
      <textarea name="notes" placeholder="Extra Notes..."></textarea><br>
      <button type="submit">Run Analysis</button>
    </form>

    <div id="result" class="box"></div>
    <canvas id="gauge" width="250" height="250"></canvas>

    <h3>📊 Parameter Trends</h3>
    <canvas id="phChart"></canvas>
    <canvas id="tdsChart"></canvas>
    <canvas id="hardnessChart"></canvas>
    <canvas id="nitrateChart"></canvas>
  </div>

  <script>
    const backend = "https://rawp.onrender.com";
    let phData = [], tdsData = [], hardnessData = [], nitrateData = [], labels = [];

    function updateGauge(risk) {
      let color = risk < 30 ? "green" : risk < 60 ? "orange" : "red";
      new Chart(document.getElementById("gauge"), {
        type: 'doughnut',
        data: {
          datasets: [{ data: [risk, 100-risk], backgroundColor:[color,"#333"] }]
        },
        options: { cutout:"75%", plugins:{legend:{display:false}} }
      });
    }

    function updateLineChart(canvasId, label, data, color) {
      new Chart(document.getElementById(canvasId), {
        type: "line",
        data: { labels: labels, datasets:[{ label: label, data: data, borderColor: color, fill:false }] },
        options: { responsive:true, scales:{ y:{ beginAtZero:true } } }
      });
    }

    document.getElementById("waterForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const res = await fetch(`${backend}/submit`, { method:"POST", body: formData });
      const data = await res.json();

      document.getElementById("result").innerHTML = `
        <h3>${data.status}</h3>
        <p>Risk Score: ${data.risk_score}</p>
        <p><b>Detected Elements:</b> ${data.detected_elements.length ? data.detected_elements.join(", ") : "None"}</p>
        <p><b>Treatment:</b> ${data.treatments.join(", ")}</p>
        <p><b>Email Status:</b> ${data.email_status.message}</p>
      `;

      // Update charts
      labels.push(`Reading ${labels.length+1}`);
      phData.push(data.scaled_inputs.ph);
      tdsData.push(data.scaled_inputs.tds);
      hardnessData.push(data.scaled_inputs.hardness);
      nitrateData.push(data.scaled_inputs.nitrate);

      updateGauge(data.risk_score);
      updateLineChart("phChart","pH",phData,"cyan");
      updateLineChart("tdsChart","TDS",tdsData,"yellow");
      updateLineChart("hardnessChart","Hardness",hardnessData,"orange");
      updateLineChart("nitrateChart","Nitrate",nitrateData,"red");
    });
  </script>
</body>
</html>
