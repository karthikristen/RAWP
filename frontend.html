<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üíß‚ò¢Ô∏è RAWP - Radioactive Water Predicter</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background:#0a0a0a; color:#e8f5e9; font-family: 'Bebas Neue', sans-serif; text-align:center; }
    h1 { color:#FFD300; text-shadow:0 0 10px #FFD300; }
    .container { width:70%; margin:auto; padding:20px; }
    input, textarea { padding:8px; margin:6px; width:80%; border-radius:6px; }
    button { padding:10px 20px; margin:10px; background:#FFD300; border:none; border-radius:6px; font-weight:bold; cursor:pointer; }
    #gauge-container { width:300px; margin:auto; }
    canvas { margin:20px auto; }
    .box { background:#111; padding:15px; border-radius:12px; margin:10px; }
  </style>
</head>
<body>
  <h1>üíß‚ò¢Ô∏è RAWP</h1>
  <p>Radioactive Water Predicter</p>

  <div class="container">
    <!-- Water Form -->
    <form id="waterForm">
      <input type="number" step="0.1" name="ph" placeholder="pH (0‚Äì100 scale)" required><br>
      <input type="number" step="0.1" name="tds" placeholder="TDS (0‚Äì100 scale)" required><br>
      <input type="number" step="0.1" name="hardness" placeholder="Hardness (0‚Äì100 scale)" required><br>
      <input type="number" step="0.1" name="nitrate" placeholder="Nitrate (0‚Äì100 scale)" required><br>
      <input type="text" name="location" placeholder="Location"><br>
      <textarea name="notes" placeholder="Extra Notes..."></textarea><br>
      <button type="submit">Run Analysis</button>
    </form>

    <div id="result" class="box"></div>

    <!-- Gauge -->
    <div id="gauge-container">
      <canvas id="gauge"></canvas>
    </div>

    <!-- Bar Chart -->
    <div id="barChartContainer">
      <canvas id="barChart"></canvas>
    </div>

    <!-- Send Email -->
    <div class="box">
      <textarea id="reportText" placeholder="Write custom report here..."></textarea><br>
      <button id="sendReport">üìß Send Report Email</button>
      <p id="emailStatus"></p>
    </div>
  </div>

  <script>
    const backend = "https://rawp.onrender.com";

    // Handle water form submit
    document.getElementById("waterForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);

      const res = await fetch(`${backend}/submit`, {
        method: "POST",
        body: formData
      });

      const data = await res.json();

      // Show results
      document.getElementById("result").innerHTML = `
        <h3>${data.status}</h3>
        <p>Risk Score: ${data.risk_score}</p>
        <p><b>Detected Elements:</b> ${data.detected_elements.length ? data.detected_elements.join(", ") : "None"}</p>
        <p><b>Treatment:</b> ${data.treatments.join(", ")}</p>
        <p><b>Email Status:</b> ${data.email_status.message}</p>
      `;

      // Gauge chart
      new Chart(document.getElementById("gauge"), {
        type: 'doughnut',
        data: {
          datasets: [{
            data: [data.risk_score, 100 - data.risk_score],
            backgroundColor: ["red", "gray"]
          }]
        },
        options: {
          cutout: "80%",
          plugins: { legend: { display: false } }
        }
      });

      // Bar chart
      new Chart(document.getElementById("barChart"), {
        type: 'bar',
        data: {
          labels: ["pH","TDS","Hardness","Nitrate"],
          datasets: [{
            label: "Your Values",
            data: [
              data.scaled_inputs.ph,
              data.scaled_inputs.tds,
              data.scaled_inputs.hardness,
              data.scaled_inputs.nitrate
            ],
            backgroundColor: "orange"
          }]
        }
      });
    });

    // Handle send report button
    document.getElementById("sendReport").addEventListener("click", async () => {
      const report = document.getElementById("reportText").value;

      if (!report.trim()) {
        document.getElementById("emailStatus").innerText = "‚ö†Ô∏è Please write something before sending.";
        return;
      }

      const res = await fetch(`${backend}/send_report`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ report })
      });

      const data = await res.json();
      document.getElementById("emailStatus").innerText = data.message || "Something went wrong.";
    });
  </script>
</body>
</html>
