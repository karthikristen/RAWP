<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>💧☢️ Radioactive Water Predicter (R.A.W.P)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #0a0a0a;
      color: #e8f5e9;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    h1 {
      color: #FFD300;
      font-size: 48px;
      text-shadow: 0 0 10px #FFD300, 0 0 20px #FF7518;
    }
    h2 {
      color: #39FF14;
      text-shadow: 0 0 8px #39FF14;
    }
    .tabs {
      margin: 20px;
    }
    .tab {
      display: inline-block;
      padding: 12px 20px;
      margin: 5px;
      cursor: pointer;
      border-radius: 8px;
      background: #111;
      color: #FFD300;
    }
    .tab:hover { background: #222; }
    .active { background: #FFD300; color: black; }
    .tab-content { display: none; margin-top: 20px; }
    .show { display: block; }
    input {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: none;
      outline: none;
    }
    button {
      background: linear-gradient(90deg, #FFD300, #FF7518);
      color: black;
      font-size: 18px;
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover { transform: scale(1.05); }
    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      font-size: 20px;
    }
    .safe { background: #003300; color: #39FF14; }
    .moderate { background: #332b00; color: yellow; }
    .danger { background: #330000; color: red; }
  </style>
</head>
<body>
  <h1>💧☢️ Radioactive Water Predicter</h1>
  <h2>AI/ML Powered Water Safety | Developed by Karthikeyan</h2>

  <!-- Tabs -->
  <div class="tabs">
    <span class="tab active" onclick="openTab('analysis')">🔍 Analysis</span>
    <span class="tab" onclick="openTab('dashboard')">📊 Dashboard</span>
    <span class="tab" onclick="openTab('awareness')">📚 Awareness</span>
  </div>

  <!-- Analysis Tab -->
  <div id="analysis" class="tab-content show">
    <div class="container">
      <h3>Enter Water Parameters</h3>
      <input type="number" id="ph" placeholder="pH Level (0-14)" step="0.1">
      <input type="number" id="tds" placeholder="TDS (mg/L)">
      <input type="number" id="hardness" placeholder="Hardness (mg/L)">
      <input type="number" id="nitrate" placeholder="Nitrate (mg/L)">
      <input type="text" id="location" placeholder="📍 Location">
      <button onclick="analyze()">Run Analysis</button>
      <div id="result" class="result"></div>
    </div>
  </div>

  <!-- Dashboard Tab -->
  <div id="dashboard" class="tab-content">
    <h3>📊 Risk Score Dashboard</h3>
    <canvas id="gaugeChart" width="300" height="300"></canvas>
    <canvas id="barChart" width="400" height="300"></canvas>
  </div>

  <!-- Awareness Tab -->
  <div id="awareness" class="tab-content">
    <h3>📚 Awareness & Treatment</h3>
    <div id="awarenessContent" style="max-width: 600px; margin:auto; text-align:left;"></div>
  </div>

  <script>
    let lastResult = null;

    // Tab switch
    function openTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('show'));
      document.getElementById(tabId).classList.add('show');
      event.target.classList.add('active');

      if (tabId === "dashboard" && lastResult) renderCharts(lastResult);
      if (tabId === "awareness" && lastResult) renderAwareness(lastResult);
    }

    async function analyze() {
      const ph = document.getElementById("ph").value;
      const tds = document.getElementById("tds").value;
      const hardness = document.getElementById("hardness").value;
      const nitrate = document.getElementById("nitrate").value;
      const location = document.getElementById("location").value;

      const data = { ph, tds, hardness, nitrate, location };

      try {
        const res = await fetch("https://rawp.onrender.com/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const result = await res.json();
        lastResult = result;

        let statusClass = "safe";
        if (result.status.includes("Moderate")) statusClass = "moderate";
        if (result.status.includes("High")) statusClass = "danger";

        document.getElementById("result").className = "result " + statusClass;
        document.getElementById("result").innerHTML = `
          <b>📍 Location:</b> ${result.location}<br>
          <b>💧 TDS:</b> ${result.tds}<br>
          <b>⚗️ pH:</b> ${result.ph}<br>
          <b>🧪 Nitrate:</b> ${result.nitrate}<br>
          <b>🪨 Hardness:</b> ${result.hardness}<br><br>
          <b>Risk Score:</b> ${result.risk_score}<br>
          <b>Status:</b> ${result.status}
        `;
      } catch (e) {
        document.getElementById("result").className = "result danger";
        document.getElementById("result").innerText = "❌ Error connecting to RAWP backend.";
      }
    }

    // Gauge + Bar Chart
    function renderCharts(result) {
      const ctxGauge = document.getElementById("gaugeChart").getContext("2d");
      new Chart(ctxGauge, {
        type: "doughnut",
        data: {
          datasets: [{
            data: [result.risk_score, 100 - result.risk_score],
            backgroundColor: ["red", "#333"],
            borderWidth: 0
          }]
        },
        options: {
          circumference: 180,
          rotation: 270,
          cutout: "70%",
          plugins: { legend: { display: false } }
        }
      });

      const ctxBar = document.getElementById("barChart").getContext("2d");
      new Chart(ctxBar, {
        type: "bar",
        data: {
          labels: ["pH", "TDS", "Hardness", "Nitrate"],
          datasets: [{
            label: "Values",
            data: [result.ph, result.tds, result.hardness, result.nitrate],
            backgroundColor: ["#39FF14", "#FFD300", "#FF7518", "red"]
          }]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
      });
    }

    // Awareness Section
    function renderAwareness(result) {
      let info = "";
      if (result.nitrate > 50) {
        info += `<p>🧪 <b>High Nitrate:</b> Can cause Blue Baby Syndrome. <br>👉 Treatment: Reverse Osmosis, Ion Exchange.</p>`;
      }
      if (result.hardness > 300) {
        info += `<p>🪨 <b>High Hardness:</b> Causes scaling and kidney risk. <br>👉 Treatment: Water Softener, Lime Softening.</p>`;
      }
      if (result.tds > 500) {
        info += `<p>💧 <b>High TDS:</b> Indicates dissolved salts/metals. <br>👉 Treatment: RO filtration, Activated Carbon.</p>`;
      }
      if (result.ph < 6.5 || result.ph > 8.5) {
        info += `<p>⚗️ <b>Abnormal pH:</b> Corrosive or alkaline water. <br>👉 Treatment: Neutralization Filters.</p>`;
      }
      if (info === "") info = "<p>✅ Your water parameters are within WHO safe limits.</p>";

      document.getElementById("awarenessContent").innerHTML = info;
    }
  </script>
</body>
</html>
